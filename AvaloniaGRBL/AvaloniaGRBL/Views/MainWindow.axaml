<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AvaloniaGRBL.ViewModels"
        xmlns:converters="using:AvaloniaGRBL.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1024" d:DesignHeight="768"
        x:Class="AvaloniaGRBL.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="AvaloniaGRBL"
        Width="1024" Height="768">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>
    
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+A" Command="{Binding AutoSizeCommand}"/>
        <KeyBinding Gesture="Ctrl+OemPlus" Command="{Binding ZoomInCommand}"/>
        <KeyBinding Gesture="Ctrl+Add" Command="{Binding ZoomInCommand}"/>
        <KeyBinding Gesture="Ctrl+OemMinus" Command="{Binding ZoomOutCommand}"/>
        <KeyBinding Gesture="Ctrl+Subtract" Command="{Binding ZoomOutCommand}"/>
    </Window.KeyBindings>
    
    <Window.Styles>
        <!-- Jog Control Buttons (Bottom Toolbar Style) -->
        <Style Selector="Button.jog-button">
            <Setter Property="Background" Value="{Binding Theme.ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.JogButtonForeground}"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding Theme.ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.jog-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.JogButtonHoverForeground}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.jog-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.JogButtonForeground}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        
        <Style Selector="Button.jog-home">
            <Setter Property="Background" Value="{Binding Theme.ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding Theme.ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.jog-home:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.jog-home:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        
        <!-- Action Button Style (Yellow highlight) -->
        <Style Selector="Button.action-button">
            <Setter Property="Background" Value="{Binding Theme.ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.ActionButtonForeground}"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding Theme.ActionButtonBorder}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.action-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.ActionButtonHoverForeground}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.action-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.ActionButtonForeground}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        
        <!-- Toolbar Buttons -->
        <Style Selector="Button.toolbar-button">
            <Setter Property="Background" Value="{Binding Theme.ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding Theme.ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.toolbar-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.toolbar-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        
        <Style Selector="Button.connect-button">
            <Setter Property="Background" Value="{Binding Theme.ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderBrush" Value="{Binding Theme.ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.connect-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.connect-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        
        <Style Selector="Button.refresh-button">
            <Setter Property="Background" Value="{Binding Theme.ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderBrush" Value="{Binding Theme.ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.refresh-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Button.refresh-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding Theme.ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>
    </Window.Styles>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="{Binding Localization[MenuGrbl]}">
                <MenuItem Header="{Binding Localization[ConnectMenu]}" Command="{Binding ConnectCommand}"/>
                <MenuItem Header="{Binding Localization[DisconnectMenu]}" Command="{Binding DisconnectCommand}"/>
                <MenuItem Header="{Binding Localization[WiFiDiscovery]}" Command="{Binding WiFiDiscoveryCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[GrblReset]}" Command="{Binding ResetGrblCommand}"/>
                <MenuItem Header="{Binding Localization[GoHome]}" Command="{Binding GoHomeCommand}"/>
                <MenuItem Header="{Binding Localization[Unlock]}" Command="{Binding UnlockCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[GrblConfiguration]}" Command="{Binding GrblConfigurationCommand}"/>
                <MenuItem Header="{Binding Localization[Settings]}" Command="{Binding SettingsCommand}"/>
                <MenuItem Header="{Binding Localization[MaterialDatabase]}" Command="{Binding MaterialDatabaseCommand}"/>
                <MenuItem Header="{Binding Localization[LaserUsageStats]}" Command="{Binding LaserUsageStatsCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[Hotkeys]}" Command="{Binding HotkeysCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[Exit]}" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="{Binding Localization[MenuFile]}">
                <MenuItem Header="{Binding Localization[OpenFile]}" Command="{Binding LoadGCodeFileCommand}"/>
                <MenuItem Header="{Binding Localization[AppendFile]}" Command="{Binding AppendGCodeFileCommand}"/>
                <MenuItem Header="{Binding Localization[ReOpenFile]}" Command="{Binding ReOpenGCodeFileCommand}"/>
                <MenuItem Header="{Binding Localization[SaveProgram]}" Command="{Binding SaveProgramCommand}"/>
                <MenuItem Header="{Binding Localization[AdvancedSave]}" Command="{Binding AdvancedSaveCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[SaveProject]}" Command="{Binding SaveProjectCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[SendFile]}" Command="{Binding StartProgramCommand}"/>
                <MenuItem Header="{Binding Localization[StartFromPosition]}" Command="{Binding StartFromPositionCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[RunMultiple]}" Command="{Binding RunMultipleCommand}"/>
            </MenuItem>
            <MenuItem Header="{Binding Localization[MenuGenerate]}">
                <MenuItem Header="{Binding Localization[PowerVsSpeed]}" Command="{Binding PowerVsSpeedCommand}"/>
                <MenuItem Header="{Binding Localization[CuttingTest]}" Command="{Binding CuttingTestCommand}"/>
                <MenuItem Header="{Binding Localization[AccuracyTest]}" Command="{Binding AccuracyTestCommand}"/>
                <MenuItem Header="{Binding Localization[ShakeTest]}" Command="{Binding ShakeTestCommand}"/>
                <MenuItem Header="ESP8266" Command="{Binding ESP8266Command}"/>
                <MenuItem Header="{Binding Localization[GrblEmulator]}" Command="{Binding GrblEmulatorCommand}"/>
            </MenuItem>
            <MenuItem Header="{Binding Localization[MenuSchema]}">
                <MenuItem Header="CAD Style" Command="{Binding SetSchemaCommand}" CommandParameter="CAD Style"/>
                <MenuItem Header="CAD Dark" Command="{Binding SetSchemaCommand}" CommandParameter="CAD Dark"/>
                <MenuItem Header="Blue Laser" Command="{Binding SetSchemaCommand}" CommandParameter="Blue Laser"/>
                <MenuItem Header="Red Laser" Command="{Binding SetSchemaCommand}" CommandParameter="Red Laser"/>
                <MenuItem Header="Dark" Command="{Binding SetSchemaCommand}" CommandParameter="Dark"/>
                <MenuItem Header="Hacker" Command="{Binding SetSchemaCommand}" CommandParameter="Hacker"/>
                <MenuItem Header="Nighty" Command="{Binding SetSchemaCommand}" CommandParameter="Nighty"/>
            </MenuItem>
            <MenuItem Header="{Binding Localization[MenuPreview]}">
                <MenuItem Header="{Binding Localization[AutoSize]}" Command="{Binding AutoSizeCommand}" InputGesture="Ctrl+A"/>
                <MenuItem Header="{Binding Localization[ZoomIn]}" Command="{Binding ZoomInCommand}" InputGesture="Ctrl++"/>
                <MenuItem Header="{Binding Localization[ZoomOut]}" Command="{Binding ZoomOutCommand}" InputGesture="Ctrl+-"/>
                <Separator/>
                <MenuItem ToggleType="CheckBox" Header="{Binding Localization[ShowLaserOffMovements]}" 
                          IsChecked="{Binding ShowLaserOffMovements, Mode=TwoWay}"/>
                <MenuItem ToggleType="CheckBox" Header="{Binding Localization[ShowExecutedCommands]}"
                          IsChecked="{Binding ShowExecutedCommands, Mode=TwoWay}"/>
                <MenuItem ToggleType="CheckBox" Header="{Binding Localization[ShowBoundingBox]}"
                          IsChecked="{Binding ShowBoundingBox, Mode=TwoWay}"/>
                <MenuItem ToggleType="CheckBox" Header="{Binding Localization[CrossCursor]}"
                          IsChecked="{Binding CrossCursor, Mode=TwoWay}"/>
            </MenuItem>
            <MenuItem Header="{Binding Localization[MenuLanguage]}">
                <MenuItem Header="English" Command="{Binding SetLanguageCommand}" CommandParameter="English"/>
                <MenuItem Header="Italian" Command="{Binding SetLanguageCommand}" CommandParameter="Italian"/>
                <MenuItem Header="Spanish" Command="{Binding SetLanguageCommand}" CommandParameter="Spanish"/>
                <MenuItem Header="French" Command="{Binding SetLanguageCommand}" CommandParameter="French"/>
                <MenuItem Header="German" Command="{Binding SetLanguageCommand}" CommandParameter="German"/>
                <MenuItem Header="Finnish" Command="{Binding SetLanguageCommand}" CommandParameter="Finnish"/>
                <MenuItem Header="Danish" Command="{Binding SetLanguageCommand}" CommandParameter="Danish"/>
                <MenuItem Header="Brazilian Portuguese" Command="{Binding SetLanguageCommand}" CommandParameter="Brazilian Portuguese"/>
                <MenuItem Header="Russian" Command="{Binding SetLanguageCommand}" CommandParameter="Russian"/>
                <MenuItem Header="Chinese (Simplified)" Command="{Binding SetLanguageCommand}" CommandParameter="Chinese (Simplified)"/>
                <MenuItem Header="Chinese (Traditional)" Command="{Binding SetLanguageCommand}" CommandParameter="Chinese (Traditional)"/>
                <MenuItem Header="Slovak" Command="{Binding SetLanguageCommand}" CommandParameter="Slovak"/>
                <MenuItem Header="Hungarian" Command="{Binding SetLanguageCommand}" CommandParameter="Hungarian"/>
                <MenuItem Header="Czech" Command="{Binding SetLanguageCommand}" CommandParameter="Czech"/>
                <MenuItem Header="Polish" Command="{Binding SetLanguageCommand}" CommandParameter="Polish"/>
                <MenuItem Header="Greek" Command="{Binding SetLanguageCommand}" CommandParameter="Greek"/>
                <MenuItem Header="Turkish" Command="{Binding SetLanguageCommand}" CommandParameter="Turkish"/>
                <MenuItem Header="Romanian" Command="{Binding SetLanguageCommand}" CommandParameter="Romanian"/>
                <MenuItem Header="Dutch" Command="{Binding SetLanguageCommand}" CommandParameter="Dutch"/>
                <MenuItem Header="Ukrainian" Command="{Binding SetLanguageCommand}" CommandParameter="Ukrainian"/>
                <MenuItem Header="Japanese" Command="{Binding SetLanguageCommand}" CommandParameter="Japanese"/>
            </MenuItem>
            <MenuItem Header="{Binding Localization[MenuTools]}">
                <MenuItem Header="{Binding Localization[InstallCH340Driver]}" Command="{Binding InstallCH340DriverCommand}"/>
                <MenuItem Header="{Binding Localization[FlashGrblFirmware]}" Command="{Binding FlashGrblFirmwareCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[ConfigurationWizard]}" Command="{Binding ConfigurationWizardCommand}"/>
            </MenuItem>
            <MenuItem Header="{Binding Localization[MenuHelp]}">
                <MenuItem Header="{Binding Localization[AutoUpdate]}" Command="{Binding ToggleAutoUpdateCommand}"
                          IsChecked="{Binding AutoUpdateEnabled}"/>
                <MenuItem Header="{Binding Localization[CheckNow]}" Command="{Binding CheckForUpdatesCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[OpenSessionLog]}" Command="{Binding OpenSessionLogCommand}"/>
                <MenuItem Header="{Binding Localization[ActivateExtendedLog]}" Command="{Binding ToggleExtendedLogCommand}"
                          IsChecked="{Binding ExtendedLogEnabled}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[HelpOnline]}" Command="{Binding HelpOnlineCommand}"/>
                <MenuItem Header="{Binding Localization[About]}" Command="{Binding AboutCommand}"/>
                <MenuItem Header="{Binding Localization[FacebookCommunity]}" Command="{Binding FacebookCommunityCommand}"/>
                <Separator/>
                <MenuItem Header="{Binding Localization[Donate]}" Command="{Binding DonateCommand}"/>
                <MenuItem Header="{Binding Localization[License]}" Command="{Binding LicenseCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Main Content Area -->
        <Grid Background="{Binding Theme.MainBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Top Toolbar -->
            <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Background="{Binding Theme.PanelBackground}" BorderBrush="{Binding Theme.BorderColor}" BorderThickness="0,0,0,1" Padding="5">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <Button Content="📄" Width="40" Height="40" Command="{Binding LoadGCodeFileCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Open File"/>
                    <Button Content="▶" Width="40" Height="40" Command="{Binding StartProgramCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Start"/>
                    <Button Content="⏸" Width="40" Height="40" Command="{Binding PauseProgramCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Pause"/>
                    <Button Content="⏹" Width="40" Height="40" Command="{Binding StopProgramCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Stop"/>
                    <Border Width="1" Background="{Binding Theme.SeparatorColor}" Margin="5,0"/>
                    <Button Content="🔄" Width="40" Height="40" Command="{Binding ResetGrblCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Reset"/>
                    <Border Width="20" Background="Transparent"/>
                    <TextBlock Text="{Binding GcodeFileName, FallbackValue='No file loaded'}" 
                               VerticalAlignment="Center" Margin="10,0,0,0" FontWeight="SemiBold" 
                               Foreground="{Binding Theme.PrimaryText}" FontSize="14"/>
                    <TextBlock Text="{Binding CurrentLine, StringFormat='Line: {0}'}" 
                               VerticalAlignment="Center" Margin="10,0,0,0" 
                               IsVisible="{Binding IsProgramRunning}" 
                               Foreground="{Binding Theme.AccentText}"/>
                    <TextBlock Text="{Binding TotalLines, StringFormat='/ {0}'}" 
                               VerticalAlignment="Center" 
                               IsVisible="{Binding IsProgramRunning}" 
                               Foreground="{Binding Theme.AccentText}"/>
                </StackPanel>
            </Border>

            <!-- Left Panel: Connection Log -->
            <Border Grid.Row="1" Grid.Column="0" Background="{Binding Theme.PanelBackground}" BorderBrush="{Binding Theme.BorderColor}" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Connection Controls -->
                    <Border Grid.Row="0" Background="{Binding Theme.MainBackground}" BorderBrush="{Binding Theme.BorderColor}" BorderThickness="0,0,0,1" Padding="10">
                        <StackPanel Spacing="8">
                            <TextBlock Text="{Binding Localization[COMPort]}" FontWeight="Bold" Foreground="{Binding Theme.PrimaryText}" FontSize="12"/>
                            <ComboBox Width="230" ItemsSource="{Binding AvailablePorts}" 
                                      SelectedItem="{Binding SelectedPort}"
                                      Background="{Binding Theme.ComboBoxBackground}" Foreground="{Binding Theme.ComboBoxForeground}"/>
                            
                            <TextBlock Text="{Binding Localization[BaudRate]}" FontWeight="Bold" Foreground="{Binding Theme.PrimaryText}" FontSize="12" Margin="0,5,0,0"/>
                            <ComboBox Width="230" ItemsSource="{Binding AvailableBaudRates}" 
                                      SelectedItem="{Binding SelectedBaudRate}"
                                      Background="{Binding Theme.ComboBoxBackground}" Foreground="{Binding Theme.ComboBoxForeground}"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="5" Margin="0,10,0,0">
                                <Button Content="{Binding IsConnected, Converter={x:Static converters:BoolToTextConverter.Instance}}" 
                                        Command="{Binding ConnectCommand}" 
                                        Width="190"
                                        Classes="connect-button"/>
                                <Button Content="↻" 
                                        Command="{Binding RefreshPortsCommand}" 
                                        Width="35" 
                                        ToolTip.Tip="{Binding Localization[RefreshPorts]}"
                                        Classes="refresh-button"/>
                            </StackPanel>
                            
                            <!-- Status Info -->
                            <Separator Margin="0,10" Background="{Binding Theme.SeparatorColor}"/>
                            <TextBlock Text="{Binding GrblState, FallbackValue='Idle'}" 
                                       FontSize="14" FontWeight="Bold" 
                                       Foreground="{Binding Theme.AccentText}" TextAlignment="Center"/>
                            <TextBlock Text="{Binding MachinePosition, FallbackValue='MPos: X:0.000 Y:0.000 Z:0.000'}" 
                                       FontFamily="Courier New" FontSize="10" 
                                       Foreground="{Binding Theme.SecondaryText}" Margin="0,5,0,0"/>
                            <TextBlock Text="{Binding WorkPosition, FallbackValue='WPos: X:0.000 Y:0.000 Z:0.000'}" 
                                       FontFamily="Courier New" FontSize="10" 
                                       Foreground="{Binding Theme.SecondaryText}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Connection Log / Console Tabs -->
                    <TabControl Grid.Row="1" Background="{Binding Theme.PanelBackground}">
                        <TabControl.Styles>
                            <Style Selector="TabItem">
                                <Setter Property="Foreground" Value="{Binding Theme.PrimaryText}"/>
                                <Setter Property="FontSize" Value="11"/>
                            </Style>
                        </TabControl.Styles>
                        
                        <!-- Connection Log Tab -->
                        <TabItem Header="Connection Log">
                            <ScrollViewer x:Name="ConnectionLogScrollViewer" Background="{Binding Theme.PanelBackground}">
                                <TextBox Text="{Binding ConnectionLog}" 
                                         IsReadOnly="True" 
                                         TextWrapping="Wrap"
                                         FontFamily="Courier New"
                                         FontSize="11"
                                         Background="{Binding Theme.PanelBackground}"
                                         Foreground="{Binding Theme.ConsoleText}"
                                         BorderThickness="0"
                                         Padding="10"/>
                            </ScrollViewer>
                        </TabItem>
                        
                        <!-- GCode Console Tab -->
                        <TabItem Header="GCode Console">
                            <Grid Background="{Binding Theme.PanelBackground}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- GCode Command Log -->
                                <ScrollViewer x:Name="GCodeLogScrollViewer" Grid.Row="0" Background="{Binding Theme.PanelBackground}">
                                    <TextBox Text="{Binding GcodeLog}" 
                                             IsReadOnly="True" 
                                             TextWrapping="Wrap"
                                             FontFamily="Courier New"
                                             FontSize="11"
                                             Background="{Binding Theme.PanelBackground}"
                                             Foreground="{Binding Theme.ConsoleText}"
                                             BorderThickness="0"
                                             Padding="10"/>
                                </ScrollViewer>
                                
                                <!-- Manual GCode Input -->
                                <Border Grid.Row="1" Background="{Binding Theme.MainBackground}" 
                                        BorderBrush="{Binding Theme.BorderColor}" BorderThickness="0,1,0,0" 
                                        Padding="5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBox Grid.Column="0" 
                                                 Text="{Binding ManualGCodeCommand, Mode=TwoWay}"
                                                 Watermark="Enter GCode command (e.g., G0 X10 Y10)"
                                                 FontFamily="Courier New"
                                                 FontSize="11"
                                                 Background="{Binding Theme.PanelBackground}"
                                                 Foreground="{Binding Theme.PrimaryText}"
                                                 Padding="5"
                                                 Margin="0,0,5,0">
                                            <TextBox.KeyBindings>
                                                <KeyBinding Gesture="Enter" Command="{Binding SendManualGCodeCommand}"/>
                                            </TextBox.KeyBindings>
                                        </TextBox>
                                        
                                        <Button Grid.Column="1" 
                                                Content="Send"
                                                Command="{Binding SendManualGCodeCommand}"
                                                Width="60"
                                                Height="30"
                                                Classes="connect-button"/>
                                    </Grid>
                                </Border>
                            </Grid>
                        </TabItem>
                    </TabControl>

                    <Border Grid.Row="2" Background="{Binding Theme.MainBackground}" BorderBrush="{Binding Theme.BorderColor}" BorderThickness="0,0,0,1" Padding="10">

                    <!-- Jog Controls -->
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <!-- Speed Setting -->
                        <StackPanel Spacing="3" HorizontalAlignment="Center">
                            <TextBlock Text="{Binding JogSpeed, StringFormat='{}{0:F0}'}" 
                                       Foreground="{Binding Theme.PrimaryText}" FontSize="11" 
                                       HorizontalAlignment="Center" FontFamily="Courier New"/>
                            <Slider Value="{Binding JogSpeed}" 
                                    Minimum="100" Maximum="3000" 
                                    Orientation="Vertical" 
                                    Height="130"
                                    Width="30"
                                    Background="{Binding Theme.SliderBackground}"
                                    Foreground="{Binding Theme.SliderForeground}"/>
                            <TextBlock Text="Speed" 
                                       Foreground="{Binding Theme.SecondaryText}" FontSize="9" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>

                        <!-- Row 1 -->
                        <StackPanel Spacing="2">
                            <Button Content="↖" Command="{Binding JogNorthWestCommand}" Classes="jog-button"/>
                            <Button Content="←" Command="{Binding JogWestCommand}" Classes="jog-button"/>
                            <Button Content="↙" Command="{Binding JogSouthWestCommand}" Classes="jog-button"/>
                        </StackPanel>
                        
                        <!-- Row 2 -->
                        <StackPanel Spacing="2">
                            <Button Content="↑" Command="{Binding JogNorthCommand}" Classes="jog-button"/>
                            <Button Content="⌂" Command="{Binding JogHomeCommand}" Classes="jog-home"/>
                            <Button Content="↓" Command="{Binding JogSouthCommand}" Classes="jog-button"/>
                        </StackPanel>
                        
                        <!-- Row 3 -->
                        <StackPanel Spacing="2">
                            <Button Content="↗" Command="{Binding JogNorthEastCommand}" Classes="jog-button"/>
                            <Button Content="→" Command="{Binding JogEastCommand}" Classes="jog-button"/>
                            <Button Content="↘" Command="{Binding JogSouthEastCommand}" Classes="jog-button"/>
                        </StackPanel>

                        <!-- Step Setting -->
                        <StackPanel Spacing="3" HorizontalAlignment="Center">
                            <TextBlock Text="{Binding JogStep, StringFormat='{}{0:G}'}" 
                                       Foreground="{Binding Theme.PrimaryText}" FontSize="11" 
                                       HorizontalAlignment="Center" FontFamily="Courier New"/>
                            <Slider x:Name="stepSlider"
                                    Value="{Binding JogStep, Converter={x:Static converters:JogStepIndexConverter.Instance}}" 
                                    Minimum="0" Maximum="10" 
                                    Orientation="Vertical" 
                                    Height="130"
                                    Width="30"
                                    Background="{Binding Theme.SliderBackground}"
                                    Foreground="{Binding Theme.SliderForeground}"
                                    TickFrequency="1"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="None"/>
                            <TextBlock Text="Step" 
                                       Foreground="{Binding Theme.SecondaryText}" FontSize="9" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                     </Border>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Row="1" Grid.Column="1" Background="{Binding Theme.BorderColor}" ResizeDirection="Columns"/>

            <!-- Main Canvas Area -->
            <Border Grid.Row="1" Grid.Column="2" Background="{Binding Theme.CanvasBackground}">
                <Grid>
                    <!-- G-Code Preview Canvas with Grid -->
                    <Canvas Name="PreviewCanvas" Background="{Binding Theme.CanvasBackground}" ClipToBounds="True">
                        <!-- Grid lines will be drawn here -->
                    </Canvas>
                    
                    <!-- Coordinate Display (Top Right) -->
                    <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Margin="20">
                        <Border Background="{Binding Theme.InfoBoxBackground}" BorderBrush="{Binding Theme.InfoBoxBorder}" BorderThickness="1" Padding="10">
                            <StackPanel>
                                <TextBlock Text="{Binding WorkPosition, FallbackValue='WCO     17,600    -52,000'}" 
                                           FontFamily="Courier New" FontSize="14" 
                                           Foreground="{Binding Theme.PrimaryText}" TextAlignment="Right"/>
                                <Grid ColumnDefinitions="Auto,Auto" Margin="0,5,0,0">
                                    <StackPanel Grid.Column="0" Spacing="2" Margin="0,0,10,0">
                                        <TextBlock Text="F" Foreground="{Binding Theme.SecondaryText}" FontSize="12"/>
                                        <TextBlock Text="S" Foreground="{Binding Theme.SecondaryText}" FontSize="12"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Spacing="2">
                                        <TextBlock Text="0" Foreground="{Binding Theme.PrimaryText}" FontSize="12" TextAlignment="Right"/>
                                        <TextBlock Text="0" Foreground="{Binding Theme.PrimaryText}" FontSize="12" TextAlignment="Right"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                    
                    <!-- Help Text (Bottom Right) -->
                    <StackPanel HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="20">
                        <TextBlock Text="{Binding Localization[BasicUsage]}" Foreground="{Binding Theme.SecondaryText}" FontSize="12" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Localization[ZoomHelp]}" 
                                   Foreground="{Binding Theme.SecondaryText}" FontSize="11"/>
                        <TextBlock Text="{Binding Localization[PanHelp]}" 
                                   Foreground="{Binding Theme.SecondaryText}" FontSize="11"/>
                        <TextBlock Text="{Binding Localization[JogHelp]}" 
                                   Foreground="{Binding Theme.SecondaryText}" FontSize="11"/>
                        <TextBlock Text="" Foreground="{Binding Theme.SecondaryText}" FontSize="11" Margin="0,5,0,0"/>
                        <TextBlock Text="{Binding Localization[KeyboardShortcuts]}" Foreground="{Binding Theme.SecondaryText}" FontSize="12" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Localization[ZoomAutoShortcut]}" Foreground="{Binding Theme.SecondaryText}" FontSize="11"/>
                        <TextBlock Text="{Binding Localization[ZoomInShortcut]}" Foreground="{Binding Theme.SecondaryText}" FontSize="11"/>
                        <TextBlock Text="{Binding Localization[ZoomOutShortcut]}" Foreground="{Binding Theme.SecondaryText}" FontSize="11"/>
                    </StackPanel>
                    
                    <!-- Placeholder message -->
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" 
                                IsVisible="{Binding !HasGCodeLoaded}">
                        <TextBlock Text="{Binding Localization[GCodePreviewArea]}" 
                                   FontSize="28" Foreground="{Binding Theme.SecondaryText}" FontWeight="Light"
                                   TextAlignment="Center"/>
                        <TextBlock Text="{Binding Localization[LoadGCodeToSeePreview]}" 
                                   FontSize="16" Foreground="{Binding Theme.SecondaryText}" Margin="0,10,0,0"
                                   TextAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" 
                    Background="{Binding Theme.PanelBackground}" BorderBrush="{Binding Theme.BorderColor}" BorderThickness="0,1,0,0" 
                    Padding="10">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="15">
                    <!-- Jog Controls -->
                    
                    
                    <Border Width="10" Background="Transparent"/>
                    
                    <!-- Additional Control Buttons -->
                    <Button Content="🎯" Classes="toolbar-button" ToolTip.Tip="Set Origin (Zero XY)" Command="{Binding SetOriginCommand}"/>
                    <Button Content="⚙" Classes="toolbar-button" ToolTip.Tip="Settings"/>
                    <Button Content="◱" Classes="toolbar-button" ToolTip.Tip="Framing - Laser ON - Low power (0.3 %)" 
                            Command="{Binding FramingCommand}" 
                            IsEnabled="{Binding CanExecuteFraming}"/>
                    <Button Content="⊕" Classes="toolbar-button" ToolTip.Tip="Target"/>
                    <Button Content="🔆" Classes="toolbar-button" ToolTip.Tip="Laser"/>
                    <Button Content="🔧" Classes="toolbar-button" ToolTip.Tip="Tools"/>
                    
                    <Border Width="20" Background="Transparent"/>
                    
                    
                </StackPanel>
            </Border>
        </Grid>
    </DockPanel>

</Window>



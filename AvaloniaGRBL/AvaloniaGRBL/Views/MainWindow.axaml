<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AvaloniaGRBL.ViewModels"
        xmlns:converters="using:AvaloniaGRBL.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1024" d:DesignHeight="768"
        x:Class="AvaloniaGRBL.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="AvaloniaGRBL"
        Width="1024" Height="768">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>
    
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+A" Command="{Binding AutoSizeCommand}"/>
        <KeyBinding Gesture="Ctrl+OemPlus" Command="{Binding ZoomInCommand}"/>
        <KeyBinding Gesture="Ctrl+Add" Command="{Binding ZoomInCommand}"/>
        <KeyBinding Gesture="Ctrl+OemMinus" Command="{Binding ZoomOutCommand}"/>
        <KeyBinding Gesture="Ctrl+Subtract" Command="{Binding ZoomOutCommand}"/>
    </Window.KeyBindings>
    
    <Window.Styles>
        <!-- Jog Control Buttons (Bottom Toolbar Style) -->
        <Style Selector="Button.jog-button">
            <Setter Property="Background" Value="{Binding ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding JogButtonForeground}"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.jog-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="{Binding JogButtonHoverForeground}"/>
        </Style>
        <Style Selector="Button.jog-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding JogButtonForeground}"/>
        </Style>
        
        <Style Selector="Button.jog-home">
            <Setter Property="Background" Value="{Binding ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.jog-home:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="Button.jog-home:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
        </Style>
        
        <!-- Action Button Style (Yellow highlight) -->
        <Style Selector="Button.action-button">
            <Setter Property="Background" Value="{Binding ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding ActionButtonForeground}"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding ActionButtonBorder}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.action-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="{Binding ActionButtonHoverForeground}"/>
        </Style>
        <Style Selector="Button.action-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding ActionButtonForeground}"/>
        </Style>
        
        <!-- Toolbar Buttons -->
        <Style Selector="Button.toolbar-button">
            <Setter Property="Background" Value="{Binding ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderBrush" Value="{Binding ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.toolbar-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="Button.toolbar-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
        </Style>
        
        <Style Selector="Button.connect-button">
            <Setter Property="Background" Value="{Binding ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderBrush" Value="{Binding ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.connect-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="Button.connect-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
        </Style>
        
        <Style Selector="Button.refresh-button">
            <Setter Property="Background" Value="{Binding ButtonBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderBrush" Value="{Binding ButtonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.refresh-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonHoverBackground}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="Button.refresh-button:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="{Binding ButtonPressedBackground}"/>
            <Setter Property="Foreground" Value="{Binding PrimaryText}"/>
        </Style>
    </Window.Styles>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_Grbl">
                <MenuItem Header="Connect..." Command="{Binding ConnectCommand}"/>
                <MenuItem Header="Disconnect" Command="{Binding DisconnectCommand}"/>
                <MenuItem Header="WiFi Discovery" Command="{Binding WiFiDiscoveryCommand}"/>
                <Separator/>
                <MenuItem Header="Grbl Reset" Command="{Binding ResetGrblCommand}"/>
                <MenuItem Header="Go Home" Command="{Binding GoHomeCommand}"/>
                <MenuItem Header="Unlock" Command="{Binding UnlockCommand}"/>
                <Separator/>
                <MenuItem Header="Grbl Configuration" Command="{Binding GrblConfigurationCommand}"/>
                <MenuItem Header="Settings" Command="{Binding SettingsCommand}"/>
                <MenuItem Header="Material Database" Command="{Binding MaterialDatabaseCommand}"/>
                <MenuItem Header="Laser Usage Stats" Command="{Binding LaserUsageStatsCommand}"/>
                <Separator/>
                <MenuItem Header="Hotkeys" Command="{Binding HotkeysCommand}"/>
                <Separator/>
                <MenuItem Header="Exit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_File">
                <MenuItem Header="Open File..." Command="{Binding LoadGCodeFileCommand}"/>
                <MenuItem Header="Append File..." Command="{Binding AppendGCodeFileCommand}"/>
                <MenuItem Header="Re-Open File" Command="{Binding ReOpenGCodeFileCommand}"/>
                <MenuItem Header="Save Program" Command="{Binding SaveProgramCommand}"/>
                <MenuItem Header="Advanced Save" Command="{Binding AdvancedSaveCommand}"/>
                <Separator/>
                <MenuItem Header="Save Project" Command="{Binding SaveProjectCommand}"/>
                <Separator/>
                <MenuItem Header="Send File" Command="{Binding StartProgramCommand}"/>
                <MenuItem Header="Start From Position" Command="{Binding StartFromPositionCommand}"/>
                <Separator/>
                <MenuItem Header="Run Multiple" Command="{Binding RunMultipleCommand}"/>
            </MenuItem>
            <MenuItem Header="_Generate">
                <MenuItem Header="Power vs Speed" Command="{Binding PowerVsSpeedCommand}"/>
                <MenuItem Header="Cutting Test" Command="{Binding CuttingTestCommand}"/>
                <MenuItem Header="Accuracy Test" Command="{Binding AccuracyTestCommand}"/>
                <MenuItem Header="Shake Test" Command="{Binding ShakeTestCommand}"/>
                <MenuItem Header="ESP8266" Command="{Binding ESP8266Command}"/>
                <MenuItem Header="Grbl Emulator" Command="{Binding GrblEmulatorCommand}"/>
            </MenuItem>
            <MenuItem Header="_Schema">
                <MenuItem Header="CAD Style" Command="{Binding SetSchemaCommand}" CommandParameter="CAD Style"/>
                <MenuItem Header="CAD Dark" Command="{Binding SetSchemaCommand}" CommandParameter="CAD Dark"/>
                <MenuItem Header="Blue Laser" Command="{Binding SetSchemaCommand}" CommandParameter="Blue Laser"/>
                <MenuItem Header="Red Laser" Command="{Binding SetSchemaCommand}" CommandParameter="Red Laser"/>
                <MenuItem Header="Dark" Command="{Binding SetSchemaCommand}" CommandParameter="Dark"/>
                <MenuItem Header="Hacker" Command="{Binding SetSchemaCommand}" CommandParameter="Hacker"/>
                <MenuItem Header="Nighty" Command="{Binding SetSchemaCommand}" CommandParameter="Nighty"/>
            </MenuItem>
            <MenuItem Header="_Preview">
                <MenuItem Header="Auto Size" Command="{Binding AutoSizeCommand}" InputGesture="Ctrl+A"/>
                <MenuItem Header="Zoom In" Command="{Binding ZoomInCommand}" InputGesture="Ctrl++"/>
                <MenuItem Header="Zoom Out" Command="{Binding ZoomOutCommand}" InputGesture="Ctrl+-"/>
                <Separator/>
                <MenuItem Header="Show Laser Off Movements" Command="{Binding ToggleLaserOffMovementsCommand}" 
                          IsChecked="{Binding ShowLaserOffMovements}"/>
                <MenuItem Header="Show Executed Commands" Command="{Binding ToggleExecutedCommandsCommand}"
                          IsChecked="{Binding ShowExecutedCommands}"/>
                <MenuItem Header="Show Bounding Box" Command="{Binding ToggleBoundingBoxCommand}"
                          IsChecked="{Binding ShowBoundingBox}"/>
                <MenuItem Header="Cross Cursor" Command="{Binding ToggleCrossCursorCommand}"
                          IsChecked="{Binding CrossCursor}"/>
            </MenuItem>
            <MenuItem Header="_Language">
                <MenuItem Header="English" Command="{Binding SetLanguageCommand}" CommandParameter="English"/>
                <MenuItem Header="Italian" Command="{Binding SetLanguageCommand}" CommandParameter="Italian"/>
                <MenuItem Header="Spanish" Command="{Binding SetLanguageCommand}" CommandParameter="Spanish"/>
                <MenuItem Header="French" Command="{Binding SetLanguageCommand}" CommandParameter="French"/>
                <MenuItem Header="German" Command="{Binding SetLanguageCommand}" CommandParameter="German"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="Install CH340 Driver" Command="{Binding InstallCH340DriverCommand}"/>
                <MenuItem Header="Flash Grbl Firmware" Command="{Binding FlashGrblFirmwareCommand}"/>
                <Separator/>
                <MenuItem Header="Configuration Wizard" Command="{Binding ConfigurationWizardCommand}"/>
            </MenuItem>
            <MenuItem Header="_?">
                <MenuItem Header="Auto Update" Command="{Binding ToggleAutoUpdateCommand}"
                          IsChecked="{Binding AutoUpdateEnabled}"/>
                <MenuItem Header="Check Now" Command="{Binding CheckForUpdatesCommand}"/>
                <Separator/>
                <MenuItem Header="Open Session Log" Command="{Binding OpenSessionLogCommand}"/>
                <MenuItem Header="Activate Extended Log" Command="{Binding ToggleExtendedLogCommand}"
                          IsChecked="{Binding ExtendedLogEnabled}"/>
                <Separator/>
                <MenuItem Header="Help Online" Command="{Binding HelpOnlineCommand}"/>
                <MenuItem Header="About" Command="{Binding AboutCommand}"/>
                <MenuItem Header="Facebook Community" Command="{Binding FacebookCommunityCommand}"/>
                <Separator/>
                <MenuItem Header="Donate" Command="{Binding DonateCommand}"/>
                <MenuItem Header="License" Command="{Binding LicenseCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Main Content Area -->
        <Grid Background="{Binding MainBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Top Toolbar -->
            <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Background="{Binding PanelBackground}" BorderBrush="{Binding BorderColor}" BorderThickness="0,0,0,1" Padding="5">
                <StackPanel Orientation="Horizontal" Spacing="5">
                    <Button Content="ðŸ“„" Width="40" Height="40" Command="{Binding LoadGCodeFileCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Open File"/>
                    <Button Content="â–¶" Width="40" Height="40" Command="{Binding StartProgramCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Start"/>
                    <Button Content="â¸" Width="40" Height="40" Command="{Binding PauseProgramCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Pause"/>
                    <Button Content="â¹" Width="40" Height="40" Command="{Binding StopProgramCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Stop"/>
                    <Border Width="1" Background="{Binding SeparatorColor}" Margin="5,0"/>
                    <Button Content="ðŸ”„" Width="40" Height="40" Command="{Binding ResetGrblCommand}" 
                            Classes="toolbar-button" ToolTip.Tip="Reset"/>
                    <Border Width="20" Background="Transparent"/>
                    <TextBlock Text="{Binding GcodeFileName, FallbackValue='No file loaded'}" 
                               VerticalAlignment="Center" Margin="10,0,0,0" FontWeight="SemiBold" 
                               Foreground="{Binding PrimaryText}" FontSize="14"/>
                    <TextBlock Text="{Binding CurrentLine, StringFormat='Line: {0}'}" 
                               VerticalAlignment="Center" Margin="10,0,0,0" 
                               IsVisible="{Binding IsProgramRunning}" 
                               Foreground="{Binding AccentText}"/>
                    <TextBlock Text="{Binding TotalLines, StringFormat='/ {0}'}" 
                               VerticalAlignment="Center" 
                               IsVisible="{Binding IsProgramRunning}" 
                               Foreground="{Binding AccentText}"/>
                </StackPanel>
            </Border>

            <!-- Left Panel: Connection Log -->
            <Border Grid.Row="1" Grid.Column="0" Background="{Binding PanelBackground}" BorderBrush="{Binding BorderColor}" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Connection Controls -->
                    <Border Grid.Row="0" Background="{Binding MainBackground}" BorderBrush="{Binding BorderColor}" BorderThickness="0,0,0,1" Padding="10">
                        <StackPanel Spacing="8">
                            <TextBlock Text="COM" FontWeight="Bold" Foreground="{Binding PrimaryText}" FontSize="12"/>
                            <ComboBox Width="230" ItemsSource="{Binding AvailablePorts}" 
                                      SelectedItem="{Binding SelectedPort}"
                                      Background="{Binding ComboBoxBackground}" Foreground="{Binding ComboBoxForeground}"/>
                            
                            <TextBlock Text="Baud" FontWeight="Bold" Foreground="{Binding PrimaryText}" FontSize="12" Margin="0,5,0,0"/>
                            <ComboBox Width="230" ItemsSource="{Binding AvailableBaudRates}" 
                                      SelectedItem="{Binding SelectedBaudRate}"
                                      Background="{Binding ComboBoxBackground}" Foreground="{Binding ComboBoxForeground}"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="5" Margin="0,10,0,0">
                                <Button Content="{Binding IsConnected, Converter={x:Static converters:BoolToTextConverter.Instance}}" 
                                        Command="{Binding ConnectCommand}" 
                                        Width="190"
                                        Classes="connect-button"/>
                                <Button Content="â†»" 
                                        Command="{Binding RefreshPortsCommand}" 
                                        Width="35" 
                                        ToolTip.Tip="Refresh Ports"
                                        Classes="refresh-button"/>
                            </StackPanel>
                            
                            <!-- Status Info -->
                            <Separator Margin="0,10" Background="{Binding SeparatorColor}"/>
                            <TextBlock Text="{Binding GrblState, FallbackValue='Idle'}" 
                                       FontSize="14" FontWeight="Bold" 
                                       Foreground="{Binding AccentText}" TextAlignment="Center"/>
                            <TextBlock Text="{Binding MachinePosition, FallbackValue='MPos: X:0.000 Y:0.000 Z:0.000'}" 
                                       FontFamily="Courier New" FontSize="10" 
                                       Foreground="{Binding SecondaryText}" Margin="0,5,0,0"/>
                            <TextBlock Text="{Binding WorkPosition, FallbackValue='WPos: X:0.000 Y:0.000 Z:0.000'}" 
                                       FontFamily="Courier New" FontSize="10" 
                                       Foreground="{Binding SecondaryText}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Connection Log / Console -->
                    <ScrollViewer Grid.Row="1" Background="{Binding PanelBackground}">
                        <TextBox Text="{Binding ConnectionLog}" 
                                 IsReadOnly="True" 
                                 TextWrapping="Wrap"
                                 FontFamily="Courier New"
                                 FontSize="11"
                                 Background="{Binding PanelBackground}"
                                 Foreground="{Binding ConsoleText}"
                                 BorderThickness="0"
                                 Padding="10"/>
                    </ScrollViewer>

                    <Border Grid.Row="2" Background="{Binding MainBackground}" BorderBrush="{Binding BorderColor}" BorderThickness="0,0,0,1" Padding="10">

                    <!-- Jog Controls -->
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <!-- Speed Setting -->
                        <StackPanel Spacing="3" HorizontalAlignment="Center">
                            <TextBlock Text="{Binding JogSpeed, StringFormat='{}{0:F0}'}" 
                                       Foreground="{Binding PrimaryText}" FontSize="11" 
                                       HorizontalAlignment="Center" FontFamily="Courier New"/>
                            <Slider Value="{Binding JogSpeed}" 
                                    Minimum="100" Maximum="3000" 
                                    Orientation="Vertical" 
                                    Height="130"
                                    Width="30"
                                    Background="{Binding SliderBackground}"
                                    Foreground="{Binding SliderForeground}"/>
                            <TextBlock Text="Speed" 
                                       Foreground="{Binding SecondaryText}" FontSize="9" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>

                        <!-- Row 1 -->
                        <StackPanel Spacing="2">
                            <Button Content="â†–" Command="{Binding JogNorthWestCommand}" Classes="jog-button"/>
                            <Button Content="â†" Command="{Binding JogWestCommand}" Classes="jog-button"/>
                            <Button Content="â†™" Command="{Binding JogSouthWestCommand}" Classes="jog-button"/>
                        </StackPanel>
                        
                        <!-- Row 2 -->
                        <StackPanel Spacing="2">
                            <Button Content="â†‘" Command="{Binding JogNorthCommand}" Classes="jog-button"/>
                            <Button Content="âŒ‚" Command="{Binding JogHomeCommand}" Classes="jog-home"/>
                            <Button Content="â†“" Command="{Binding JogSouthCommand}" Classes="jog-button"/>
                        </StackPanel>
                        
                        <!-- Row 3 -->
                        <StackPanel Spacing="2">
                            <Button Content="â†—" Command="{Binding JogNorthEastCommand}" Classes="jog-button"/>
                            <Button Content="â†’" Command="{Binding JogEastCommand}" Classes="jog-button"/>
                            <Button Content="â†˜" Command="{Binding JogSouthEastCommand}" Classes="jog-button"/>
                        </StackPanel>

                        <!-- Step Setting -->
                        <StackPanel Spacing="3" HorizontalAlignment="Center">
                            <TextBlock Text="{Binding #stepSlider.Value, Converter={x:Static converters:JogStepIndexConverter.Instance}, StringFormat='{}{0:G}'}" 
                                       Foreground="{Binding PrimaryText}" FontSize="11" 
                                       HorizontalAlignment="Center" FontFamily="Courier New"/>
                            <Slider x:Name="stepSlider"
                                    Value="{Binding JogStep, Converter={x:Static converters:JogStepIndexConverter.Instance}}" 
                                    Minimum="0" Maximum="10" 
                                    Orientation="Vertical" 
                                    Height="130"
                                    Width="30"
                                    Background="{Binding SliderBackground}"
                                    Foreground="{Binding SliderForeground}"
                                    TickFrequency="1"
                                    IsSnapToTickEnabled="True"
                                    TickPlacement="None"/>
                            <TextBlock Text="Step" 
                                       Foreground="{Binding SecondaryText}" FontSize="9" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                     </Border>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Row="1" Grid.Column="1" Background="{Binding BorderColor}" ResizeDirection="Columns"/>

            <!-- Main Canvas Area -->
            <Border Grid.Row="1" Grid.Column="2" Background="{Binding CanvasBackground}">
                <Grid>
                    <!-- G-Code Preview Canvas with Grid -->
                    <Canvas Name="PreviewCanvas" Background="{Binding CanvasBackground}" ClipToBounds="True">
                        <!-- Grid lines will be drawn here -->
                    </Canvas>
                    
                    <!-- Coordinate Display (Top Right) -->
                    <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Margin="20">
                        <Border Background="{Binding InfoBoxBackground}" BorderBrush="{Binding InfoBoxBorder}" BorderThickness="1" Padding="10">
                            <StackPanel>
                                <TextBlock Text="{Binding WorkPosition, FallbackValue='WCO     17,600    -52,000'}" 
                                           FontFamily="Courier New" FontSize="14" 
                                           Foreground="{Binding PrimaryText}" TextAlignment="Right"/>
                                <Grid ColumnDefinitions="Auto,Auto" Margin="0,5,0,0">
                                    <StackPanel Grid.Column="0" Spacing="2" Margin="0,0,10,0">
                                        <TextBlock Text="F" Foreground="{Binding SecondaryText}" FontSize="12"/>
                                        <TextBlock Text="S" Foreground="{Binding SecondaryText}" FontSize="12"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Spacing="2">
                                        <TextBlock Text="0" Foreground="{Binding PrimaryText}" FontSize="12" TextAlignment="Right"/>
                                        <TextBlock Text="0" Foreground="{Binding PrimaryText}" FontSize="12" TextAlignment="Right"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                    
                    <!-- Help Text (Bottom Right) -->
                    <StackPanel HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="20">
                        <TextBlock Text="Basic usage" Foreground="{Binding SecondaryText}" FontSize="12" FontWeight="Bold"/>
                        <TextBlock Text="ZOOM: Use mouse wheel (or two-finger gesture)" 
                                   Foreground="{Binding SecondaryText}" FontSize="11"/>
                        <TextBlock Text="PAN:  Click and drag (or touch and drag)" 
                                   Foreground="{Binding SecondaryText}" FontSize="11"/>
                        <TextBlock Text="JOG:  Double click in any point (or double tap)" 
                                   Foreground="{Binding SecondaryText}" FontSize="11"/>
                        <TextBlock Text="" Foreground="{Binding SecondaryText}" FontSize="11" Margin="0,5,0,0"/>
                        <TextBlock Text="Keyboard Shortcuts" Foreground="{Binding SecondaryText}" FontSize="12" FontWeight="Bold"/>
                        <TextBlock Text="Ctrl A: Zoom Auto (100%)" Foreground="{Binding SecondaryText}" FontSize="11"/>
                        <TextBlock Text="Ctrl +: Zoom In   (+10%)" Foreground="{Binding SecondaryText}" FontSize="11"/>
                        <TextBlock Text="Ctrl -: Zoom Out  (-10%)" Foreground="{Binding SecondaryText}" FontSize="11"/>
                    </StackPanel>
                    
                    <!-- Placeholder message -->
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" 
                                IsVisible="{Binding !HasGCodeLoaded}">
                        <TextBlock Text="G-Code Preview Area" 
                                   FontSize="28" Foreground="{Binding SecondaryText}" FontWeight="Light"
                                   TextAlignment="Center"/>
                        <TextBlock Text="Load a G-Code file to see the preview" 
                                   FontSize="16" Foreground="{Binding SecondaryText}" Margin="0,10,0,0"
                                   TextAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" 
                    Background="{Binding PanelBackground}" BorderBrush="{Binding BorderColor}" BorderThickness="0,1,0,0" 
                    Padding="10">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="15">
                    <!-- Jog Controls -->
                    
                    
                    <Border Width="10" Background="Transparent"/>
                    
                    <!-- Additional Control Buttons -->
                    <Button Content="ðŸŽ¯" Classes="toolbar-button" ToolTip.Tip="Center"/>
                    <Button Content="âš™" Classes="toolbar-button" ToolTip.Tip="Settings"/>
                    <Button Content="ðŸ”²" Classes="toolbar-button" ToolTip.Tip="Frame"/>
                    <Button Content="âŠ•" Classes="toolbar-button" ToolTip.Tip="Target"/>
                    <Button Content="ðŸ”†" Classes="toolbar-button" ToolTip.Tip="Laser"/>
                    <Button Content="ðŸ”§" Classes="toolbar-button" ToolTip.Tip="Tools"/>
                    
                    <Border Width="20" Background="Transparent"/>
                    
                    
                </StackPanel>
            </Border>
        </Grid>
    </DockPanel>

</Window>
